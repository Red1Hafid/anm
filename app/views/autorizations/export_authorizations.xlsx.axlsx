wb = xlsx_package.workbook

wb.add_worksheet(name: "Rapport des autorisations") do |sheet|
  # Create the header row
  sheet.add_row ["Présnom", "Nom", "Département", "Date de sortie", "heure de début", "heure de reprise", "heures prise", "Status", "Reste à régulariser / h", "Etat", "choix de recouverement", "Date de la demande", "date de soumission", "date de validation", "date de refus", "Raison de refus", "historique de recouverement"]
  # Create entries for each item
  @autorizations.each do |a|
    sheet.add_row [a.user.first_name, a.user.last_name, a.department, a.date, a.start_hour, a.end_hour, a.time_taken, a.status, a.stay_hour, a.is_ok == false ? "Ouvert" : "Fermé", a.recovery_method == "1" ? "Retrancher de mon solde de congé" : "Répartition des heures sur les autres jours travaillés de la semaine", a.demand_date.nil? ? a.demand_date : a.demand_date.strftime("%d/%m/%Y %H:%M"), a.submit_date.nil? ? a.submit_date : a.submit_date.strftime("%d/%m/%Y %H:%M"), a.validate_date.nil? ? a.validate_date : a.validate_date.strftime("%d/%m/%Y %H:%M"), a.refus_date.nil? ? a.refus_date : a.refus_date.strftime("%d/%m/%Y %H:%M"), a.refus_motif, a.history.size == 0 ? "" : a.history]
  end
end